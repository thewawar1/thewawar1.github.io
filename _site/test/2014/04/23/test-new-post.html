<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Test New Post(测试新建文章)</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">My new Blog</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Test New Post(测试新建文章)</h2>
<p class="meta">23 Apr 2014</p>

<div class="post">
<p>一些Python代码</p>

<div class="highlight"><pre><code class="python"><span class="k">class</span> <span class="nc">VideoSpider</span><span class="p">(</span><span class="n">CrawlSpider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;videos&#39;</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;http://unity3d.com/learn/tutorials/modules/beginner&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topics</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mkdir -p /tmp/videos&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mkdir videos&#39;</span><span class="p">)</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spider_closed</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">spider_closed</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        
        <span class="n">sel</span> <span class="o">=</span> <span class="n">Selector</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">cur_level_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">cur_topic_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">cur_topic</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">cur_topic_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">g12n_lst</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s">&#39;.g12n&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">g12n</span> <span class="ow">in</span> <span class="n">g12n_lst</span><span class="p">:</span>
            <span class="c"># Header</span>
            <span class="k">if</span> <span class="n">g12n</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s">&#39;.g12n.mb10&#39;</span><span class="p">):</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">g12n</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s">&#39;.pa20 h1.mb0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&#39;text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">descr</span> <span class="o">=</span> <span class="n">g12n</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s">&#39;.pt10.mb0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&#39;text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cur_topic</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                    <span class="s">&#39;descr&#39;</span><span class="p">:</span> <span class="n">descr</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                    <span class="s">&#39;levels&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">}</span>
                <span class="n">cur_topic_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;videos&#39;</span><span class="p">,</span> <span class="n">save_filename</span><span class="p">(</span><span class="n">cur_topic</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">cur_level_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">cur_topic_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_topic</span><span class="p">)</span>
            <span class="c"># Section blocks                </span>
            <span class="k">elif</span> <span class="n">g12n</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s">&#39;.g12n.mb20&#39;</span><span class="p">):</span> 
                <span class="n">title</span> <span class="o">=</span> <span class="n">g12n</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s">&#39;.g12 h4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&#39;text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cur_level</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                    <span class="s">&#39;videos&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">}</span>
                <span class="n">cur_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cur_topic_path</span><span class="p">,</span> <span class="n">cur_level</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;mkdir -p </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">cur_path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Level.CMD: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">cmd</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                <span class="n">cur_level_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">cur_topic</span><span class="p">[</span><span class="s">&#39;levels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_level</span><span class="p">)</span>
                <span class="c"># One section</span>
                <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">g12n</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s">&#39;.g4.mb0 p.mb0 a&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&#39;@href&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://unity3d.com/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">url</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&#39;text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">video</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s">&#39;number&#39;</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span>
                        <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                    <span class="p">}</span>
                    <span class="n">cur_level</span><span class="p">[</span><span class="s">&#39;videos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_video</span><span class="p">,</span>
                                  <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;cur_path&#39;</span><span class="p">:</span> <span class="n">cur_path</span><span class="p">,</span>
                                        <span class="s">&#39;cur_topic_idx&#39;</span><span class="p">:</span> <span class="n">cur_topic_idx</span><span class="p">,</span>
                                        <span class="s">&#39;cur_level_idx&#39;</span><span class="p">:</span> <span class="n">cur_level_idx</span><span class="p">,</span>
                                        <span class="s">&#39;cur_video_idx&#39;</span><span class="p">:</span> <span class="n">number</span><span class="o">-</span><span class="mi">1</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;End Section.&#39;</span>
</code></pre></div>

</div>


          <div class="footer">
            <div class="contact">
              <p>
                GitHub:<br />
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/thewawar1">github.com/thewawar1</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
